(function(){"use strict";angular.module("wu.masonry",[]).controller("MasonryCtrl",["$scope","$element","$timeout",function(t,n,r){function f(e){e.addClass("loaded")}var i={};var s=[];var o=false;var u=this;var a=null;this.preserveOrder=false;this.loadImages=true;this.scheduleMasonryOnce=function(){var t=arguments;var n=s.filter(function(n){return n[0]===t[0]}).length>0;if(!n){this.scheduleMasonry.apply(null,arguments)}};this.scheduleMasonry=function(){if(a){r.cancel(a)}s.push([].slice.call(arguments));a=r(function(){if(o){return}s.forEach(function(t){n.masonry.apply(n,t)});s=[]},30)};this.appendBrick=function(t,r){function s(){if(Object.keys(i).length===0){n.masonry("resize")}if(i[r]===undefined){i[r]=true;f(t);n.masonry("appended",t,true)}}function a(){u.scheduleMasonryOnce("layout")}if(o){return}if(!u.loadImages){s();a()}else if(u.preserveOrder){s();t.imagesLoaded(a)}else{t.imagesLoaded(function(){s();a()})}};this.removeBrick=function(t,r){if(o){return}delete i[t];n.masonry("remove",r);this.scheduleMasonryOnce("layout")};this.destroy=function(){o=true;if(n.data("masonry")){n.masonry("destroy")}t.$emit("masonry.destroyed");i=[]};this.reload=function(){n.masonry();t.$emit("masonry.reloaded")}}]).directive("masonry",function(){return{restrict:"AE",controller:"MasonryCtrl",link:{pre:function(t,n,r,i){var s=t.$eval(r.masonry||r.masonryOptions);var o=angular.extend({itemSelector:r.itemSelector||".masonry-brick",columnWidth:parseInt(r.columnWidth,10)||r.columnWidth},s||{});n.masonry(o);var u=t.$eval(r.loadImages);i.loadImages=u!==false;var a=t.$eval(r.preserveOrder);i.preserveOrder=a!==false&&r.preserveOrder!==undefined;t.$emit("masonry.created",n);t.$on("$destroy",i.destroy)}}}}).directive("masonryBrick",function(){return{restrict:"AC",require:"^masonry",scope:true,link:{pre:function(t,n,r,i){var s=t.$id,o;i.appendBrick(n,s);n.on("$destroy",function(){i.removeBrick(s,n)});t.$on("masonry.reload",function(){i.scheduleMasonryOnce("reloadItems");i.scheduleMasonryOnce("layout")});t.$watch("$index",function(){if(o!==undefined&&o!==t.$index){i.scheduleMasonryOnce("reloadItems");i.scheduleMasonryOnce("layout")}o=t.$index})}}}})})()